# Proxy upstream configuration
# Included inside location {} blocks that need to proxy to the backend
# Contains rate limiting, backend selection, and proxy settings

# Apply conditional rate limiting
limit_req zone=global_limit burst=50 nodelay;
limit_req_status 429;

set $backend '';

access_by_lua_block {
    require("backend-select").select(ngx.var.uri)
}

include conf.d/proxy-settings.conf;
